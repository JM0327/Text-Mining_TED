---
title: "Embedding"
author: "Ting Yang"
date: "09/12/2022"
output: html_document
---

# Word Embedding

```{r}
TED.coo <- fcm(TED.tk,
               context = "window",
               window = 5,
               tri = FALSE) 
head(TED.coo)
```
For example, the co-occurrence of word *artificial* and *intelligence* is large(170). But the co-occurrence of word *fly* and *intelligence* is very small(0). 

```{r}
set.seed(123)
p <- 2 # word embedding dimension
TED.glove <- GlobalVectors$new(rank = p,
                               x_max = 10) # x_max is a needed technical option
TED.we <- TED.glove$fit_transform(TED.coo) # central vectors; speech.glove$components contains the context vectors
TED.we <- t(TED.glove$components) + TED.we# unique representation
```

```{r}
index <- textstat_frequency(dfm(TED.tk))[1:100, ]$feature
index ## words with the 150 largest frequencies
```

```{r}
data.for.plot <- data.frame(TED.we[index, ])
data.for.plot$word <- row.names(data.for.plot)
ggplot(data.for.plot, 
       aes(x = X1,
           y = X2,
           label = word)) +
  geom_text_repel(max.overlaps = 100) + 
  theme_void() 
```
Words that are close on the map are often used together (e.g. "ai" and "technology", “relationship” and "friend").

```{r}
TED.we.df <- as.data.frame(TED.we)
word <- rownames(TED.we.df)
TED.we.df <- cbind(word,TED.we.df)
e <- c(1:15045)
row.names(TED.we.df) <- e
```

another kind of plot
```{r}
ggplot(TED.we.df,aes(x=V1,y=V2))+
  geom_text_repel(data = subset(TED.we.df, V1 <=-1.8|V2>3|V1>2),
            mapping = aes(label = word),
            hjust = "inward",
            max.overlaps = 100) +
  geom_point(color="grey")
```


# Document Embedding

```{r}
head(TED.tk[[1]])
head(TED.we[TED.tk[[1]], ])
apply(TED.we[TED.tk[[1]],], 2, mean) ## average all these vectors => Document 1 vector
```

```{r}
nd <- length(TED.tk) # number of documents
TED.de <- matrix(nr = nd, nc = p) # document embedding matrix (1 document per row)
for(i in 1:nd) {
  words_in_i <- TED.we[TED.tk[[i]], , drop = FALSE] 
  # drop = FALSE is needed in case there is only one token
  TED.de[i, ] <- apply(words_in_i, 2 ,mean)
}
row.names(TED.de) <- names(TED.tk)
head(TED.de) ## document vectors
```

```{r}
TED.de <- as.data.frame(TED.de)
TED.de.source <- TED_full %>% 
  select(2,3,4) %>% cbind(TED.de) 

ggplot(data=TED.de.source,mapping = aes(
  x=V1,
  y=V2,
  color=cate))+
  geom_point()+
  labs(x = "dimension1",
    y = "dimension2")+
  scale_colour_discrete(
    name="Category",
    breaks=c("1","2","3"),
    labels=c("AI","Climate change","Relationships")
  )
```



